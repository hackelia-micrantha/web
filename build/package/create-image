#!/usr/bin/env bash

LOCAL_IMAGE=micrantha/web
REMOTE_IMAGE=registry.gitlab.com/micrantha/web
VERSION=$(git describe --tags || echo "v0.0.1")

docker build -t ${REMOTE_IMAGE}:${VERSION} -t ${REMOTE_IMAGE}:latest -t $LOCAL_IMAGE -f build/package/Dockerfile $@ .

# no timeout
read -t 15 -p "Pushing image in 15 seconds.  Hit ENTER to continue or CTRL-C to cancel."
docker push --all-tags $REMOTE_IMAGE
